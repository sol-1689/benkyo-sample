
# Webサイトを表示する仕組み

## なにこれ？  
皆さんはChromeやSafariなどのブラウザから、googleやyoutubeなどのWebサイトを表示したことがあるかと思います。  
ただ、どのような仕組みでWebサイトが表示されているかまでは分かってない方もいるのではないでしょうか。

弊社の開発案件ではそのようなブラウザからアクセスするWebサイトを作成することも多く、どのような仕組みかを理解する必要があります。

この記事はWebサイトを表示する仕組みを理解できるようになることを目的としています。


## 対象者
Webサイトを表示する仕組みがいまいちよく分からない人  

## 

## Webサイト表示の流れ
まず初めに、Webサイトを表示する際の大まかな流れを記載します。
その後に、それぞれのフェーズの細かい内容を説明していきます。

1. （人）ブラウザ上にURLを入力


1. （ブラウザ）URLからWebサーバーのIPを取得  
正確にはOSに依頼しています。

1. （ブラウザ）IPを取得したWebサーバーに対して、HTTPと呼ばれる形式のメッセージを送信（HTTPリクエストと呼ばれます。）  
送信する処理はOSに依頼しています。

1. （Webサーバー）HTTPリクエストを受け取り、返却すべきコンテンツを準備  
Html、Css、javascriptなどの、ブラウザが画面を描画する為に必要なファイルを返却します。

1. （Webサーバー）HTTP形式のメッセージで作成した値を返却（HTTPレスポンスと呼ばれます。）

1. （ブラウザ）HTTPレスポンスからWebサーバーが返却した（Htmlなどの）値を取り出し、その内容に応じで画面を描画する。


図



## 各部分の詳細

### （ブラウザ）URLからWebサーバーのIPを取得  
ブラウザがURLからWebサーバーのIPを取得する手順は大まかに以下になります。

1. URLからサーバー名に当たる部分を抜き出し  


ブラウザはまずURLを解析し、URLの中からサーバー名を表す箇所を抜き出します。  
URLはいくつかの要素で構成されています。  

例えば以下のURLがあった場合  

http://yahoo.co.jp/aaa/bbb/ccc  

以下のように分解できます。  

http yahoo.co.jp aaa/bbb/ccc  
ここは図で書くか  

このうちプロトコルの後ろの部分がサーバー名になります。  
正確にはサーバーのドメイン名と呼ばれる情報になります。

URLのどこにどの要素が記載されているかは、後述するHTTPの仕様の一部として規定されています。  
URLの仕様についての詳しい解説は別記事で行います。

2. サーバー名に対応するIPをDNSサーバーに問い合わせる  
実際にサーバーと通信する際は、サーバーのドメイン名では無くIPアドレスが必要になります。  
ドメイン名に対応するIPを取得する為にはDNSという仕組みを利用します。  
詳しい内容はネットワーク的な話になるので省略しますが、DNSサーバーに対してドメインに対するIPを教えて下さいとリクエストすることになります。（ネットワーク的な内容を解説している参考書籍を末尾に記載しています。）  
DNSに問い合わせる機能自体は実際はOSが持っており、ブラウザはOSが提供する機能を利用して問い合わせを行っています。  

図



図
(DNSサーバーはOSに設定されています。例えばWindowsだと以下の画面から設定できます。)  

図  



ちなみにURLのサーバー名部分に直接IPアドレスを記載することも可能です。  
その場合DNSに問い合わせる手順はスキップされます。  


### （ブラウザ）Webサーバーに対してHTTPリクエストを送信  
ブラウザはHTTPリクエストというメッセージを作成し、URLから取得したIPに対して送信します。  

HTTP、HTTPリクエストとは何かについて、以下簡単に説明します。  
(もう少し詳しい説明は別記事で行います。)  

この部分の説明をする為に、まずHTTPについて簡単に説明します。  



> #### HTTPとは  

> ブラウザーなどのウェブクライアントとWebサーバーの間で、HTMLファイルなどのさまざまなデータをやりとりするために使用するプロトコル（通信規約）のことです。  
HTTPの仕様はIETFという標準化団体が策定しています。  
参考：[仕様文書](https://triple-underscore.github.io/rfc-others/RFC2616-ja.html#section-4)  


> HTTPでは、HTTPメッセージと呼ばれる、必要な情報を記述した文字列データをやり取りします。
HTTPでは、HTTPメッセージと呼ばれる文字列データをやり取りして必要な情報を伝え合います。    

> HTTPメッセージには以下の2種類があります。  
> - HTTPリクエスト  
クライアントが送信してサーバーにアクションを起こさせる為のHTTPメッセージ  

> - HTTPレスポンス  
HTTPリクエストに対するサーバーの回答であるHTTPメッセージ  


> 図  


> メッセージの仕様（どこにどんな情報をどうやって記載するか）はHTTPプロトコルの仕様の1部として[規定](https://triple-underscore.github.io/rfc-others/RFC2616-ja.html#section-4)されています。  

> #### HTTPリクエストの内容
> ブラウザがなどのクライアントが送信するHTTPリクエストは、以下のような文字列になります。  
> 例  


> HTTPリクエストは大まかに以下のブロックに分かれます。  
> - 開始行  
要求メソッド、リクエスト対象（絶対URLからプロトコル名とドメイン名を除いたもの）、HTTPプロトコルのバージョン

> - HTTPヘッダー  
サーバーに対してどの種類 (例えば、言語や MIME タイプ) のデータが適切かを示す情報や、サーバーの動作を変える (例えば、すでにキャッシュされている場合は回答を送信しない) データを与えます。これらの HTTP ヘッダーは空行で終わるブロックを構成します。


> - 本文  
最後のブロックは省略可能なデータブロックで、主に POST メソッドで使用される追加のデータを含みます。  



以上が簡単なHTTPの説明になります。  
もう少し詳しい説明は別記事で行います。  

この中で説明したHTTPリクエストを生成し、URLから取得したサーバーIPに対して送信する、という作業をブラウザが行ってくれます。  


### （Webサーバー）HTTPリクエストを受け取り、返却すべきコンテンツを準備  

ブラウザから送られてきたHTTPリクエストをWebサーバーが受け取り、Webサーバーアプリに受け渡されます。  

Webサーバーアプリはリクエストの内容を解析し、リクエストの内容によって返すべきコンテンツを準備します。  
ブラウザからのリクエストに対しては、まずHtmlというWebページを表示する為のファイルを返却します。  

どのようなファイルかを返すかは、URLのパスやパラメータによって判断します。  
例えば /mypageなら～  
このようなどのリクエストに対してどのコンテンツを返すかのルールは開発者が決め実装します。

Webページにはヘルプページのような内容が変わらない静的ファイルや、マイページのようにユーザーによって内容が異なる動的ファイルがあります。  

動的ファイルの場合は、javaなどの言語で書かれてアプリケーションを呼び出し、データベースから取り出した情報をもとにHtmlファイルを作成するような作業が必要になります。  
このあたりは後で詳しく説明します。  

### （Webサーバー）HTTP形式のメッセージで作成した値を返却（HTTPレスポンスと呼ばれます。）






#### HTTPメソッド

- GET

- POST

API公開している例上げる

URLは同じですがにHTTPメソッドの違いにより動作が異なります。  
APIを利用する側にとっても分かりやすい為、このような作りになっている物も多いです。



#### ブラウザがHTTPリクエストを送るタイミング

- URL欄から遷移



- formからのsubmit


#### Webサーバーへのパラメータの渡し方

- クエリストリング


- リクエストボデイ
  - formのsubmit時

  - プログラムでの実装時 



### HTTP形式のメッセージで作成した値を返却



## 仕様の策定について
前述したとおりHTTPやHTMLなどの仕様は仕様策定団体によって定義されており、  
主要なブラウザアプリやWebサーバーアプリはその仕様に準拠する形で実装されています。  

例えばChromeなどのブラウザはHTTPリクエストを送る際、仕様通り先頭行に要求メソッド・リクエスト対象などを記載しますし、apacheなどのWebサーバーアプリは仕様通り先頭行に要求メソッド・リクエスト対象などが書かれている前提で送られてきたHTTPリクエストを解析します。    

このように共通の仕様を前提に各アプリが実装されている為、どのような組合せでもHTTPのやり取りを行えるわけです。  


もし共通の仕様が決まっておらず、例えばChromeはHTTPリクエストの先頭行にURLを記載するが、firefoxは末尾の行で定義する、apacheはリクエストの先頭行にURLが想定で動作するがnginxは末尾の行の前提で動作する、などなってしまうと、特定のブラウザとWebアプリの組合せでしかやりとりが出来なくなってしまいます。  

これはHTML、css、javascriptにも同じことが言えます。  

例えばHTMLに<button>ボタン</button>というタグがあれば画面上にボタンを表示する、という共通のルールに従ってブラウザはHTMLから画面を描画します。  

Windowsのchromもedgeも、iOSのsafariでも、Androidのchromeも全てその仕様に従って画面を描画する為、どのブラウザで見ても同じWebページが閲覧できるわけです。  

これがもしchromeはbuttonタグでボタンを描画するが、edgeではただのラベルを描画する、などなると、各ブラウザ向けに返却するHTMLを変えなくてはいけなくなります。  

このような事態を避ける為に仕様策定団体が存在しており、各アプリの開発ベンダーもそれに従っているわけです。  
この仕様には強制力はありませんが、仕様に準拠していないアプリは扱いにくくなるため利用者が減ってしまいます。  
その為自然とこの仕様に従うようになります。  


#### IEについて



## Webアプリケーションとは
Webサイトの集合体。
例えばECサイトならマイページ、商品一覧、注文ページなど、それらを表示する為の機能をまとめたものをWebアプリケーションという。

図
各ページの図＋プログラムをWebサイトに乗せる図？





・MDN HTTPについての説明サイト  
https://developer.mozilla.org/ja/docs/Web/HTTP


・MDN URLとは何か  
https://developer.mozilla.org/ja/docs/Learn/Common_questions/What_is_a_URL


・サーバー
https://wa3.i-3-i.info/word144.html


・tomcat
https://wa3.i-3-i.info/word12843.html
https://thinkit.co.jp/free/article/0708/2/1
https://agency-star.co.jp/column/tomcat


・アプリケーションサーバー

https://www.otsuka-shokai.co.jp/words/application-server.html

アプリケーションサーバーにはアプリケーションプログラムによって以下のような種類がある。
（1）Java：「Tomcat」「Glass Fish」
（2）PHP：「Apache」
（3）Ruby：「Unicorn」「Thin」「Rainbows」「Puma」

マイクロソフトのIIS（Internet Information Services）はWebサーバーとアプリケーションサーバーの機能を統合しVisual Basic、C#などの言語で記述したプログラムが作動している。

Appサーバーをwebサーバーとして利用しない理由
https://qiita.com/yCroma/items/e46476e2ac7c372bb2a3

2015年Webサーバアーキテクチャ序論
https://blog.yuuk.io/entry/2015-webserver-architecture



・ブラウザ周りの仕様
https://qiita.com/megmogmog1965/items/e180d02be711cecdc038
