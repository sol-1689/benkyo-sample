
# Webサイトを表示する仕組み_補足

## なにこれ？  
Webサイトを表示する仕組みについて、長くなったので分割しました。  




#### HTTPメソッド

- GET

- POST

API公開している例上げる

URLは同じですがにHTTPメソッドの違いにより動作が異なります。  
APIを利用する側にとっても分かりやすい為、このような作りになっている物も多いです。  

|    |  HTTPメソッド  |  HTTPリクエストの送信  |  HTTPレスポンスへの対応  |    |
| ---- | ---- | ---- | ---- | ---- |


#### ブラウザがHTTPリクエストを送るタイミング
直接URLを入力する以外にも、ブラウザがHTTPを送信するタイミングがあります。  


- ページ上のリンクから遷移した際  
例えばyahooのニュースクリックした際などの動作です。  
リンクはhtml上はaタグで作成されています。  
クリックすると、href属性で指定されているURLをブラウザに直接入力した時と同じ動作になります。

ブラウザが送信するHTTPはGETメソッドとなり、javascriptの変数などの情報は全てクリアされます。  



- フォームデータの送信  
フォームとはhtmlのformタグで囲まれた部分の事で、画面上でユーザーに入力してもらった情報をサーバーに送信する際などに利用します。  
例えばユーザー登録画面で、顧客が入力した名前などの情報をサーバーに送る際などに利用します。  
例  



htmlのformタグの中にある`type="submit"`属性が指定されたボタンを押すと、
formタグのaction属性に指定されたURLにHTTPリクエストが送信されます。  
（フォームをサブミットするなどと言います。）    
その際のHTTPメソッドは`method`属性で指定されたものになります。
また、送られるHTTPリクエストのリクエストボディに、formタグ内のフォームコントロール要素の値が記載されます。  

例　　
<form action="http://www.foo.com" method="GET">
  <input name="say" id="say" value="Hi">
  <input name="to" id="to" value="Mom">
  <button>Send my greetings</button>
</form>


送られるリクエスト例  



サーバー側はリクエストボディの値を取り出し、登録などの処理を行うことになります。  

URLにパラメータが含まれない為、URLだけをコピーしても同じ処理は行えません。  
その為、ブックマークされ再度リクエストを送られたくないURLによく利用されます。　　
（登録、削除を行う処理のURLなど  ）



- javascriptからのリクエスト  

上の2つの場合は、ブラウザがHTTPリクエストの作成・送信とレスポンスに対する処理（Htmlの描画）を自動で行ってくれました。  
それとは別に、ブラウザに返却したJavascriptからリクエストを発行する事も出来ます。  
この場合、Httpメッセージの作成・送信やレスポンスに対する処理を自分でコーディングしなくてはいけません。  

ただし１から全て実装しなければいけないのではなく、Http通信を行うための関数が標準仕様で用意されています。   
用意されている方法は2種類あり、XMLRequestとFetchの2種類あります。  

Fetchの方が新しく、IE以外のブラウザなら対応しています。  
IEのサポートは2022/7に切れるため、それ以降はFetchが主に使われることになります。  


サーバーからのレスポンスに対してもブラウザは何もしない為、自分でどのような処理をしたいかjavascript上デコーディングする必要があります。  
（例えばサーバーから返ってきた値を画面のどこかに表示するなど）  

その関数でがHttpレスポンスを受け取ることも出来ます。  
そのレスポンスに対する処理もコードで記述する必要があります。  

例  
最初に例かく？　　

この方法でリクエストを投げた場合、ブラウザはページの再読み込みを行いません。  
その為、今のページのままで画面の一部を変更したい場合などによく利用します。  
（検索を押したら検索結果を表示している部分だけを変えるなど。）  
またjavascriptで持つ変数などもそのままになります。  

図  
gif  

また、サーバーからの戻り値はhtmlではなく、プログラムで解釈しやすり**Json**という形式のファイルを返すことが多いです。  

#### Json
プロパティ名:値 形式のフォーマットです。  

例    

javascriptのオブジェクトにそのまま変換できます。  

例  


以下、それぞれの呼び出し方の特徴をまとめました。  

|    |  HTTPメソッド  |  HTTPリクエストの送信  |  HTTPレスポンスへの対応  |    |
| ---- | ---- | ---- | ---- | ---- |
|  リンクから遷移  |  GET  | ブラウザが行う  | ブラウザが行う  |   |
|  フォームデータの送信  |  GET or POST <br>(formタグのmethod属性で指定する)  | ブラウザが行う  | ブラウザが行う  |   |
|  javascriptから送信  |  自由<br>（Httpメッセージ作成メソッドの引数で指定する。）  | javascriptでコーディング  | javascriptでコーディング  |   |


#### Webサーバーへのパラメータの渡し方
画面の入力値などのパラメータをサーバーに渡したいことがよくあります。  
（例えばユーザー登録画面で登録ボタンを押したときに、ユーザー名や住所などの情報を送りたい など） 

その際はHTTPリクエストにパラメータ情報を含めてサーバーに送ることになります。    
リクエストにパラメータを含める方法はいくつかあります。  



1. クエリストリング  
URLの末尾の`?`以降の文字列にパラメータを記載します。   
 
例  

パラメータは`キー=値`の形式で記載します。  
URLのこの部分を**クエリ文字列**といいます。

この方法はGETメソッドでリクエストする際に良く用いられます。  
formタグのmethod属性にGETが指定されていた場合、formタグ内のinputタグなどの入力値が、submit時にクエリストリングに記載されます。  

  - メリット  
  URLにパラメータ情報が含まれている為、お気に入りから再度開いた際などでも同じパラメータを渡すことが出来ます。  

  - デメリット  
  ただブラウザによってURLの文字数の最大値が決まっている為、あまり長いパラメータを渡すことは出来ません。  



1. リクエストボディにフォームデータ形式で記述  
formタグのmethod属性でPOSTを指定していた場合、formタグ内のinputタグなどの入力値が、submit時にリクエストボディに記載されます。  

例  

ボディにはキー=値形式で記載され、複数ある場合は&で連結されます。  

  - メリット  
  URLにパラメータが含まれない為、ブックマークされたURLを後で開いても同じ処理は行えません。  
  その為、登録・削除などの複数回呼ばれたくない処理や、URLに表示したくない情報（個人情報や機密情報）がある場合によく利用されます。
  また、パラメータの文字数制限もありません。  

  - デメリット  
URLにパラメータが含まれない為、ブックマークされたURLを後で開いても同じ処理は行えません。  



1. リクエストボディにフォームデータ以外の形式で記述  
javascriptなどでHttpリクエストを自分で作って発行する際は、リクエストボディにフォームデータ形式以外の形式でパラメータを含めることがあります。  
よく使われるのはjsonの文字列をリクエストボディに含める方法です。  

例  

  - メリット  
  配列やネストしたデータなどはjsonの方が表現しやすい為、プログラムからデータを送る際はこの形式で送ることが多いです。  
（json形式に変換する為のメソッドもある為、処理も簡単です。 ）

  - デメリット  
  サーバー側でリクエストボディのjsonを再変換する処理が必要になります。


まとめると以下になります。  

|    |  メリット  |  デメリット   |    |    |
| ---- | ---- | ---- | ---- | ---- |
|  クエリストリング  |  GET  | GET  | GET  |   |
|  リクエストボディにフォームデータ形式で記述  |  GET  | GET  | GET  |   |
|  リクエストボディにフォームデータ以外の形式で記述  |  GET  | GET  | GET  |   |

##### どの方法を使うか

ブラウザのformタグからリクエストを送る場合は①か②のいずれかの形式になります。  
javascriptからの場合はコーディングしだいでどの形式でも送れます。  

どの方法でパラメータを送るかは、設計者・開発者が決めることです。  

例えばクエリストリングで送ると決めれば、htmlやjavascirptはそのようなリクエストを送るように実装し、サーバー側はリクエストのクエリストリングからパラメータを取得するように実装します。  




#### SPA（シングルページアプリケーション）とは

リンク遷移した場合、javascript上の変数の値はクリアされます。  

#### Webアプリケーションの公開  


## いろいろな呼び方
Webサイトの集合体。
例えばECサイトならマイページ、商品一覧、注文ページなど、それらを表示する為の機能をまとめたものをWebアプリケーションという。

図
各ページの図＋プログラムをWebサイトに乗せる図？


#### クライアントアプリからの呼び出し  


・MDN HTTPについての説明サイト  
https://developer.mozilla.org/ja/docs/Web/HTTP


・MDN URLとは何か  
https://developer.mozilla.org/ja/docs/Learn/Common_questions/What_is_a_URL


・サーバー
https://wa3.i-3-i.info/word144.html


・tomcat
https://wa3.i-3-i.info/word12843.html
https://thinkit.co.jp/free/article/0708/2/1
https://agency-star.co.jp/column/tomcat


・アプリケーションサーバー

https://www.otsuka-shokai.co.jp/words/application-server.html

アプリケーションサーバーにはアプリケーションプログラムによって以下のような種類がある。
（1）Java：「Tomcat」「Glass Fish」
（2）PHP：「Apache」
（3）Ruby：「Unicorn」「Thin」「Rainbows」「Puma」

マイクロソフトのIIS（Internet Information Services）はWebサーバーとアプリケーションサーバーの機能を統合しVisual Basic、C#などの言語で記述したプログラムが作動している。

Appサーバーをwebサーバーとして利用しない理由
https://qiita.com/yCroma/items/e46476e2ac7c372bb2a3

2015年Webサーバアーキテクチャ序論
https://blog.yuuk.io/entry/2015-webserver-architecture



・ブラウザ周りの仕様
https://qiita.com/megmogmog1965/items/e180d02be711cecdc038
