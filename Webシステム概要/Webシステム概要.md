
# Webシステム概要  

## なにこれ？  
弊社の開発案件ではWebシステムを作成することも多いです。
ただ、Webシステムとはそもそも何かよく分からない人や、概要は知っていてもどのような仕組みで動くものなのが分からない人もいるかと思います。

この記事はそういった方たちが、Webシステムの仕組みを理解できるようになることを目的としています。


## 対象者
Webシステムと聞いてもいまいちよく分からない人  

## Webシステムとは

Webシステムとは何でしょうか。  
実はWebシステムという言葉に明確な定義はありません。  
似た言葉にWebアプリケーションやWebサービスなどがありますが、微妙に違うニュアンスで使われることもあれば、同じ意味で使われることもあります。  

ここでは混乱を避けるため、以下のシステムのことをWebシステムと呼ぶことにします。  

Webサーバー上で動作し、HTTPリクエストに対して処理を行うプログラム  
ブラウザを使ったシステム

図  

## Webアプリケーションの呼び出し方

WebアプリケーションはHTTPリクエストによって動作すると定義しました。  

Webアプリケーションに対してHTTPリクエストを送るクライアントは、主に以下の2つです。  
HTTPリクエストが送られてくるのは、大きく2つあります。  

Webアプリケーションは主に以下の2つの方法で呼び出されます。  

- ブラウザからの呼び出し  
ブラウザにURLを入力したり、リンクをクリックした際のWebページ表示です。  
図  

この場合、Webアプリケーションはブラウザが画面描画の為に使用するHtml、Css、Javascriptなどのファイルを返却します。  
HTTPリクエストの作成と送信、Webアプリケーションから返却されたファイルを解析して画面を描画する処理は、ブラウザが行ってくれます。  

図  

- ブラウザで動作するjavascriptからの呼び出し  

ブラウザにロードされたjavascript空の呼び出しです。  
ブラウザに人がURLを入力した場合と異なり、ブラウザがWebアプリケーションからの結果を解釈して何かを行うことはありません。  
どのような処理を行うかはjavascriptのコードで記述する必要があります。  

図  

- クライアントアプリ、またはブラウザで動作するjavascriptからの呼び出し  
iOS、Android、Windowsなどにインストールしたアプリからの呼び出し、またはブラウザ上で動作するJavascriptからの呼び出しです。  

要は別のプログラムからの呼び出しというイメージです。  

この場合、Webアプリケーションは呼び出し元プログラムが解釈しやすい形式のファイル（主にJson）を返します。  

この場合、HTTPリクエストの作成と送信と、Webアプリケーションから返却された結果を解釈しどう処理するかは自分でコードを書く必要があります。  

図  


以上のようにWebアプリケーションの呼び出し方は複数ありますが、図を見てもらうと分かる用、HTTPを介して呼び出される流れは同じです。  



## Webシステムの処理の流れ詳細  
Webシステムの処理の流れは大まかに以下になります。


図

それぞれの詳細は長くなるので別記事にしますが、概要だけ以下に記載します。

1. ブラウザ→サーバーへリクエスト

1. サーバーで処理を行う。
必要であればDBから情報を取得し、ブラウザに返却するファイルを作成

1. サーバーからの返却値をもとに結果を描画



ブラウザからがWebサーバーにアクセスする方法は大きく分けて2つあります。

1. ブラウザのページ全体が再読み込みされるもの
ブラウザにURLを入力したり、Webページ上のリンクをクリックした場合の挙動です。
URLへのリクエストの発行や、結果の描画はブラウザが自動的に行います。

図
ページ全体が変わるさまを図に書く？

1. ブラウザのページは置き換わらず、javascript上から呼び出されるもの
Ajaxなどと呼ばれます。
リクエストの発行や、サーバーからのレスポンスをどう扱うかはjavascriptで記述します。
ブラウザが何かすることはありません。


どちらのパターンもありますが、ここでは基本的な①の流れを最初に説明します。

その後に②の流れを説明します。











HTTPでアクセスされるWebサーバー上で稼働するプログラムやサイトのことをWebシステムといいます。

・ブラウザにWebサイトを表示する

・アプリケーションに必要な情報を返却する。


■サイト閲覧時の流れ説明

　　流れの図書く
　　・ブラウザにURLうつ
　　・URLに対応したIPをもつサーバーに、HTTPリクエストを送信する（ブラウザ）
　　・Webサーバー(で稼働しているWebサーバーアプリ)がリクエストを受け取る。
　　　リクエストの内容(URLや引数)に応じて、ブラウザに返す結果(Htmlファイル)を作成し、
　　　Httpレスポンスという形式にのせてブラウザに返却する。
　　・ブラウザは結果を受け取り、内容を画面に描画する。

　　　
　　上記の1つずつを説明
　　・URLに対応したIPをもつサーバーに、HTTPリクエストを送信する（ブラウザ）

　　　・ブラウザがURLに対応するIPを取得

　　　・そのIPに対して通信を行う。
　　　　その際、HTTPリクエストという形式のテキストファイルを送信する。

　　　　HTTPリクエストの例の図
　　　　URLや接続元の情報、受取可能な文字コードなどの各種情報が書かれていることを記載

　　　　HTTPリクエストの仕様は仕様策定団体により定義されている。
　　　　ブラウザやWebサーバーはその仕様にそってアプリを実装しているので、互いに通信できる。

　　　・実際の通信処理はOSが行っている（参考）

　　・Webサーバー(で稼働しているWebサーバーアプリ)がリクエストを受け取る。
　　　リクエストの内容(URLや引数)に応じて、ブラウザに返す結果(Htmlファイル)を作成し、
　　　Httpレスポンスという形式にのせてブラウザに返却する。

　　　・サーバー側はHttpリクエストの中身に応じて結果を返す。
　　　　このURLの場合はこの内容を返すなど。
　　　　例えば/help.htmlならヘルプページを表示する為のファイルを返すなど。
　　　　ブラウザにサイトを表示する際は、HTML、CSS、javascriptなどのファイルをブラウザに返してあげる必要がある。
　　　　(jsonを返す場合もあります。)

　　　・ブラウザに返すファイルは、HTTPレスポンスという形式のテキストファイルに乗せて返却する。
　　　　HTTPリクエストと同じくフォーマットは仕様で決まっている。

　　　　ヘッダー→どのような文字コードか、どれくらいのサイズかなどの情報が記載されている
　　　　ボディ→htmlなどの実際に返したい内容

　　　・ブラウザはHTTPレスポンスを解析し、中身を取り出す。　　　

　　　　中身がhtmlの場合は、その内容に従ってブラウザに描画する。
　　　　

　　　・HTMLとは
　　　　
      　実際の例
      　<div>～</div> →　ブラウザでどう表示されるか。
      　
      　どのようなタグを打たれたらどういった表示をしなくてはいけないかは共通の仕様が策定されている。
      　→主要なブラウザはその仕様の従っているので、同じhtmlファイルならどのブラウザで見ても同じ表示になる。

      ・css
        デザインをまとめて記載したもの。
        こちらもhtmlと同じく共通の仕様が作成されている。
        実際の記載例

      ・javascript
        ブラウザ上で動作するプラグラム。
        ボタン押したら色変えるなどのサンプル。
        こちらも文法などが仕様で決まっている。
        実際の記載例

      まとめ的に、それぞれの役割の表
      html
      css
      javascript

      ↑の三つのファイル→ブラウザ→描画された画面　みたいな図


　　　・それぞれのファイルの文法仕様
　　　html、css、jsの文法・仕様は仕様を策定する団体によって定義されており、主要なブラウザはその仕様に従っている。
　　　　そのため、異なるブラウザで表示しても同じ画面が表示される。
　　　　（差異がある場合もあるが。。IE11など）

　　　　（ちなみに）入力と出力が定義されているだけど、実際の実装はブラウザによリ異なる。
　　　　→ブラウザによってパフォーマンス変わる原因
　　　

　　　jsonのケースの説明もする？
　　　そういう場合もあるという事だけ触れるか、補足として別にまとめるか。


　　　
・Webサーバーの部分詳細

　　Webサーバ→Appサーバ→DBサーバの図を書く

　　・各サーバーの役割紹介
　　　　・Webサーバー
　　　　　
　　　　　静的ファイルを返す（ヘルプページなど）
　　　　　SSLの処理なども行う。　
　　　　　Javaなどのプログラムを動かすことは出来ない（プラグイン使えば出来るかもだが機能が貧弱）

　　　　　nginx、Apache HTTP Server、IIS

　　　　　ただ、実際には動的にページを作ることが多い。
　　　　　マイページなど。ログインしているユーザーによって内容が変わる。（例の画面を出す）

　　　　　DBから情報を取得し、動的にHTMLなどを作って返す必要がある
　　　　　→javaなどのプログラムで実装

　　　　　
　　　　　javaなどのプログラムを動かせるサーバーアプリが必要
　　　　　→Appサーバー
　　　　　

　　　　・Appサーバー
         HTTPリクエストを受け取り、プログラムに受け渡し、プログラムから出力された結果を返却する機能を持つ。
　　　　　プログラムはJavaなどの言語で作成する。
         動的にHTMLページなどを作る際に利用。
         言語によっていろいろな種類がある。

         言語ごとのアプリサーバーの例を表示
         「Tomcat」「Glass Fish」「IIS」

         そのサーバーアプリに対応する言語でかかれたプログラムを動かすことが出来る。
         ただ、どんなプログラムでも動かせるわけではなく、そのAppサーバーが求める仕様に乗っ取って作られたアプリである必要がある。
         例えばJavaなら言語の開発元が策定したサーブレットの仕様があり、大半のAppサーバーアプリはその形式を想定している。
         
         サーブレットの仕様の例
         https://www.cresc.co.jp/tech/java/Servlet_Specifications/servlet_3-0_about.htm

         こういうメソッドがあってこういうルールで呼ばれるなどが定義されていることを示す。

         その他の言語の仕様も表示
         ASP.netなど

         図
         Tomcat   プログラム(Javaでサーブレット仕様にのっとったもの)←ここを開発する。

        
         （受け渡し方は言語やアプリサーバが準拠するサーバー側の実装の仕様による。javaでいうサーブレット）
         例を表示
         こういうルールを定義するとURLとプログラムが紐付けられる的な


         Webサーバーとの違い
         Httpリクエストを受け付けることは出来るが、最低限の機能しかない。
         WebサーバーにあるようなSSLの対応やリクエスト・レスポンスの変更機能などは基本ない。


         対応表
         　　　　　　　Http関連の機能　　動的ページ作成　　　　　　　　　　　　　　　静的コンテンツ配置
         Webサーバ　　豊富　　　　　　　　不可
         　　　　　　　　　　　　　　　　（言語によってはプラグインで可能）　　　　　　可能
         
         Appサーバ　　最低限　　　　　　　可能
         　　　　　　　　　　　　　　　　（そのAppサーバーアプリが対応する言語なら）　　可能

         


　　　　・WebサーバーとAppサーバーの使い分け
　　　　　→両方使うことが多い

　　　　　nginx →　tomcat

         図を書く

         nginxでsslの処理などを行い、tomcatに転送
         tomcatはnginxで使ってるポートは使えないので8080などの適当なポートを使う。

         設定の例

         ただし言語によって構成は異なる
         例えば.NET系のWebプログラムを動かすIISは、Webサーバー、Appサーバー両方の機能を持つ。
         （.NET系の言語に対してのみ）

         PHPはWebサーバーのプラグインとしてAppサーバーの機能を追加する場合が多い


         Tomcat、IIS

         J2ee参考
         https://thinkit.co.jp/free/article/0708/2/2


　　　　　IISのように、特定の言語(.NET系)に対してはWebサーバーとAppサーバー両方の機能を持つものもある。

   
         ・標準のフレームワークだと上長になりがちなので、記述を楽にするためのライブラリを使うことが多い。

         　例）Spring、ASP .NET MVC
　　　　　
          コード例



　　　　・DBサーバー
　　　　　データベースアプリを稼働させる。　
　　　　　特定のポートをリッスン。

　　　　　アプリケーションから利用する。
　　　　　接続用のライブラリを使う。（コード例）

　　　　　DBへのコネクションの貼り方などは使用するDBアプリにより決まっている。
　　　　　アプリからその仕様に乗っ取って接続する必要がある。
　　　　　仕様の例？
　　　　　→いちいち実装するの大変　　
　　　　　→DB作ってる会社が主要な言語向けのライブラリ公開してるのでそれ使う。

　　　　　・DBとのコネクションを貼る
         →各DBベンダーが公開しているライブラリを使用。
         接続文字列を投げればその中でよろしくやってくれる。

　       ・SQLを投げる
　　     →これもライブラリで出来る。
　　　      もしくは言語としてそういった仕組みが用意されている


      　　→ただし、そのまま使うと冗長な記述になりがち

      　　→楽に書くためのライブラリを使用（ORマッパーと呼ばれる）

      　　→コードのサンプル

　　　　　



・ブラウザ ⇔ Httpサーバー仕組み

　　・HTTPリクエスト

　　・HTTPレスポンス

　　・HTML

　　・CSS

　　・Javascript




・Httpサーバー ⇔ DBサーバーの仕組み


   　





・サーバー
https://wa3.i-3-i.info/word144.html


・tomcat
https://wa3.i-3-i.info/word12843.html
https://thinkit.co.jp/free/article/0708/2/1
https://agency-star.co.jp/column/tomcat


・アプリケーションサーバー

https://www.otsuka-shokai.co.jp/words/application-server.html

アプリケーションサーバーにはアプリケーションプログラムによって以下のような種類がある。
（1）Java：「Tomcat」「Glass Fish」
（2）PHP：「Apache」
（3）Ruby：「Unicorn」「Thin」「Rainbows」「Puma」

マイクロソフトのIIS（Internet Information Services）はWebサーバーとアプリケーションサーバーの機能を統合しVisual Basic、C#などの言語で記述したプログラムが作動している。

Appサーバーをwebサーバーとして利用しない理由
https://qiita.com/yCroma/items/e46476e2ac7c372bb2a3

2015年Webサーバアーキテクチャ序論
https://blog.yuuk.io/entry/2015-webserver-architecture



・ブラウザ周りの仕様
https://qiita.com/megmogmog1965/items/e180d02be711cecdc038
